Sub SplitRowsIntoSheetsWithRedFlagSection()
    Dim wsSource As Worksheet
    Dim lastRow As Long, lastCol As Long
    Dim i As Long, j As Long
    Dim redFlagCol As Long
    Dim newSheet As Worksheet
    Dim headerCell As Range, dataCell As Range

    ' Set your source sheet
    Set wsSource = ThisWorkbook.Sheets("Source") ' Update name if needed

    ' Determine last row and column
    lastRow = wsSource.Cells(wsSource.Rows.Count, 1).End(xlUp).Row
    lastCol = wsSource.Cells(1, wsSource.Columns.Count).End(xlToLeft).Column

    ' Find "red flag" column
    redFlagCol = 0
    For j = 1 To lastCol
        If Trim(LCase(wsSource.Cells(1, j).Value)) = "red flag" Then
            redFlagCol = j
            Exit For
        End If
    Next j

    If redFlagCol = 0 Then
        MsgBox "Column 'red flag' not found!", vbExclamation
        Exit Sub
    End If

    ' Loop through each data row
    For i = 2 To lastRow
        Set newSheet = ThisWorkbook.Sheets.Add(After:=ThisWorkbook.Sheets(ThisWorkbook.Sheets.Count))
        newSheet.Name = "Row_" & (i - 1)

        ' --- Copy full headers with formatting to row 1 ---
        For j = 1 To lastCol
            Set headerCell = wsSource.Cells(1, j)
            headerCell.Copy
            newSheet.Cells(1, j).PasteSpecial Paste:=xlPasteFormats
            newSheet.Cells(1, j).Value = headerCell.Value
        Next j

        ' --- Copy full row data to row 2 ---
        For j = 1 To lastCol
            Set dataCell = wsSource.Cells(i, j)
            dataCell.Copy
            newSheet.Cells(2, j).PasteSpecial Paste:=xlPasteFormats
            newSheet.Cells(2, j).Value = dataCell.Value
        Next j

        ' --- Reprint headers after "red flag" to row 4 ---
        For j = redFlagCol + 1 To lastCol
            Set headerCell = wsSource.Cells(1, j)
            headerCell.Copy
            newSheet.Cells(4, j - redFlagCol).PasteSpecial Paste:=xlPasteFormats
            newSheet.Cells(4, j - redFlagCol).Value = headerCell.Value
        Next j

        ' --- Reprint row values after "red flag" to row 5 ---
        For j = redFlagCol + 1 To lastCol
            Set dataCell = wsSource.Cells(i, j)
            dataCell.Copy
            newSheet.Cells(5, j - redFlagCol).PasteSpecial Paste:=xlPasteFormats
            newSheet.Cells(5, j - redFlagCol).Value = dataCell.Value
        Next j
    Next i

    Application.CutCopyMode = False
    MsgBox "Done! " & (lastRow - 1) & " sheets created with post-'red flag' sections.", vbInformation
End Sub